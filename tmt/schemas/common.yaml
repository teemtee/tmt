---

#
# Common JSON Schema definitions
#

$id: /schemas/common
$schema: https://json-schema.org/draft-07/schema

definitions:

  # list of all recognized architectures
  arch:
    type: string
    enum:
      - aarch64
      - armhfp
      - i386
      - ppc64
      - ppc64le
      - s390x
      - x86_64

  # https://tmt.readthedocs.io/en/stable/spec/tests.html#require
  beakerlib_library:
    allOf:
      - $ref: "/schemas/common#/definitions/fmf_id_base"

    additionalProperties: false

    properties:
      url: true
      ref: true
      path: true
      name: true
      nick:
        type: string

  # https://tmt.readthedocs.io/en/stable/spec/tests.html#duration
  # https://tmt.readthedocs.io/en/stable/spec/plans.html#shell
  duration:
    type: string
    pattern: "^[0-9]+[smhd]$"

  # https://tmt.readthedocs.io/en/stable/spec/tests.html#environment
  # https://tmt.readthedocs.io/en/stable/spec/plans.html#environment
  environment:
    $ref: "/schemas/common#/definitions/object_of_strings"

  # https://fmf.readthedocs.io/en/stable/concept.html#identifiers
  fmf_id:
    allOf:
      - $ref: "/schemas/common#/definitions/fmf_id_base"

    additionalProperties: false

    properties:
      url: true
      ref: true
      path: true
      name: true

  # helper used by beakerlib_library and fmf_id
  fmf_id_base:
    type: object
    minProperties: 1
    properties:
      url:
        type: string
        # TODO: maybe also "format: uri"
        # together with "pattern" to enforce http instead
        # of all possible protocols?
        pattern: "^https?://"

      ref:
        type: string

      path:
        type: string

      name:
        type: string
        pattern: "^/"

  # https://tmt.readthedocs.io/en/stable/spec/core.html#link
  link:
    anyOf:
      - $ref: "common#/definitions/link_without_note"

      - type: object
        properties:
          note:
            type: string

  # part of link without a note
  link_without_note:
    type: object

    additionalProperties: false
    minProperties: 1
    maxProperties: 1

    properties:
      verifies:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      verified-by:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      implements:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      implemented-by:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      documents:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      documented-by:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      blocks:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      blocked-by:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      duplicates:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      duplicated-by:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      parent:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      child:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

      relates:
        $ref: "/schemas/common#/definitions/url_path_or_fmf_id"

  # helper for specifying an object with string properties
  object_of_strings:
    type: object

    additionalProperties:
      type: string

  # helper for specifying a string or an array of strings
  string_or_array:
    oneOf:
      - type: string

      - type: array
        items:
          type: string

  # helper for specifying aarray of strings
  array_of_strings:
    type: array
    items:
      type: string

  # helper
  url:
    type: string
    pattern: "^https?://"

  # a url, path or fmf_id
  url_path_or_fmf_id:
    oneOf:
      - $ref: "/schemas/common#/definitions/url"

      - type: string
        pattern: "^/"

      - $ref: "/schemas/common#/definitions/fmf_id"
